<!-- Sidebar -->
<ul class="navbar-nav sidebar sidebar-dark accordion" id="accordionSidebar">
  <!-- Sidebar - Brand -->
  <%= link_to chatrooms_path, class:'sidebar-brand d-flex align-items-center justify-content-center' do %> 
    <div class="sidebar-brand-icon">
      <%= image_tag "duck-plain.svg", :title => "title", :class => "sidebar-brand-icon svg-inline--fa" %>
    </div>
    <div class="sidebar-brand-text mx-3">Slowduck</div>
  <% end %>


  <!-- Divider -->
  <hr class="sidebar-divider">

  <% if user_signed_in? %>

    <!-- Heading -->
    <div class="sidebar-heading my-3">
      群組聊天室 
    </div>


    <% current_user.group_chatrooms.each do |room|%>
      <!-- Nav Item - Pages Collapse Menu -->
      <li class="nav-item">
        <%= link_to  room, class:'nav-link py-3', data: {behavior: "chatroom-link", chatroom_id: room.id} do %>
          <span><%= "#{room.name}" %></span>
          <i class='fa fa-exclamation d-none text-warning ml-2' aria-hidden='true'></i>
        <% end %>
        <%= link_to '#', class:'tab-menu-link', data: {toggle:'collapse', target:"#collapse#{room.id}"} do %>
          <i class="fas fa-fw fa-cog"></i>
        <% end %>
        <div id="collapse<%= room.id%>" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
          <div class="bg-white py-2 collapse-inner rounded">
            <%= link_to '編輯', edit_chatroom_path(room.slug), class:'collapse-item' %> 
            <%= link_to '退出', chatroom_path(room.id), class:'collapse-item' , method:'delete', data:{confirm:'你確定要退出聊天室嗎'} %>
          </div>
        </div>
      </li>
    <% end %>

    <!-- divider -->
    <hr class="sidebar-divider">

    <!-- Heading -->
    <div class="sidebar-heading my-2">
      一對一對話
    </div>


    <% current_user.conversations.each do |room|%>
      <!-- Nav Item - Pages Collapse Menu -->
      <li class="nav-item py-0">
        <%= link_to  room, class:'nav-link d-flex flex-row align-items-center py-3', data: {behavior: "chatroom-link", chatroom_id: room.id} do %>
          <% if room.conversation_with(current_user).online == 1 %>
            <%= user_image(room.conversation_with(current_user) , 32) %>
            <span class="ml-3"><%= "#{room.conversation_with(current_user).username} <i class='fa fa-exclamation d-none text-warning ml-2' aria-hidden='true'></i>".html_safe %></span>
          <% else %>
            <div class="offline">
              <%= user_image(room.conversation_with(current_user) , 32) %>
              <span class="ml-3"><%= "#{room.conversation_with(current_user).username} <i class='fa fa-exclamation d-none text-warning ml-2' aria-hidden='true'></i>".html_safe %></span>
            </div>
          <% end %>
        <% end %>
        <%= link_to  hide_chatroom_chatroom_path(room.id), class:'tab-menu-link close1on1 mt-1', method:'post' do %>
          <i class="fas fa-times"></i>
        <% end %>
      </li>
    <% end %>


    <!-- Divider -->
    <hr class="sidebar-divider d-none d-md-block">

  <% end %>

  <!-- Sidebar Toggler (Sidebar) -->
  <div class="text-center d-none d-md-inline">
    <button class="rounded-circle border-0 new-chatroom">
      <%= link_to  new_chatroom_path, class:'nav-link' do  %>
        <i class="fas fa-plus text-dark"></i>
      <% end %>
    </button>
  </div>

</ul>
<!-- End of Sidebar -->
